(()=>{"use strict";var e,t={7930:(e,t,r)=>{var n=r(7294),o=r(3935),a=r(5975),i=r(840),u=r.n(i),l=r(3157),c=r(8100),f=r(888);function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function p(e,t){if(e){if("string"==typeof e)return m(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(e,t):void 0}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function v(e,t){return v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},v(e,t)}function h(e,t){if(t&&("object"===s(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function b(e,t,r){return t&&g(e.prototype,t),r&&g(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}r(9957);var w={onError:console.error},E=function(){function e(t){y(this,e),this.errorHandler=t}return b(e,[{key:"onError",value:function(){var e;(e=this.errorHandler).onError.apply(e,arguments)}},{key:"wrapPromise",value:function(e){var t=this;return e.catch((function(e){if(e instanceof Error)t.errorHandler.onError(e);else try{throw new Error("Promise rejected with reason "+(null==e?void 0:e.toString()))}catch(e){t.errorHandler.onError(e)}return Promise.reject(e)}))}},{key:"wrap",value:function(e){var t=this;return function(){try{return e.apply(void 0,arguments)}catch(e){throw t.errorHandler.onError(e),e}}}}]),e}(),O=n.createContext(new E(w)),S=function(){return(0,n.useContext)(O)},x=n.createContext([]),C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v(e,t)}(a,e);var t,r,o=(t=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=d(t);if(r){var o=d(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return h(this,e)});function a(e){var t;return y(this,a),(t=o.call(this,e)).state={error:null,errorInfo:null},t}return b(a,[{key:"componentDidCatch",value:function(e,t){this.setState({error:e,errorInfo:t})}},{key:"render",value:function(){return this.state.errorInfo?n.createElement(P,{error:this.state.error,details:this.state.errorInfo.componentStack}):this.props.children}}]),a}(n.Component);function j(e){var t,r,o=e.children,a=e.chainErrorHandler,i=(t=(0,n.useState)([]),r=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a=[],i=!0,u=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){u=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(u)throw o}}return a}}(t,r)||p(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=i[0],l=i[1],c=(0,n.useMemo)((function(){return new E({onError:function(e){l((function(t){return[].concat(function(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||p(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t),[e])})),a&&a.onError(e)}})}),[a]);return n.createElement(x.Provider,{value:u},n.createElement(O.Provider,{value:c},o))}function A(e){var t=e.errors;return n.createElement("div",{className:"errorLog"},t.map((function(e){return n.createElement(P,{error:e,key:e})})))}function P(e){var t=e.error,r=e.details;return null!=t&&t.stack||r?n.createElement("details",{className:"errorLogEntry"},n.createElement("summary",null,null==t?void 0:t.toString()),(null==t?void 0:t.stack)&&n.createElement("div",{className:"stackTrace"},null==t?void 0:t.stack),r&&n.createElement("div",{className:"details"},r)):n.createElement("div",{className:"errorLogEntry"},null==t?void 0:t.toString())}function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function I(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(Object(r),!0).forEach((function(t){k(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function k(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var N=function(e){return Array(e).fill().map((function(e,t){return t}))},_=function(e){return e},M=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){for(var r=t.length-1;r>=0;r--)e=t[r](e);return e}},R=function(e){return e instanceof Function?e:(t=e,function(){return t});var t};function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function D(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function L(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?D(Object(r),!0).forEach((function(t){U(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function U(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var B={map:_,pure:_,ap:_},H={map:function(e){return _}},G=function(e){return function(t){return function(r){return function(n){return r.map((function(t){return L(L({},n),{},U({},e,t))}))(t(r)(null==n?void 0:n[e]))}}}},V=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return new Proxy(M.apply(void 0,t),$(t))},$=function(e){var t={};return{get:function(r,n,o){if(t[n])return t[n];var a,i=V.apply(void 0,(a=e,function(e){if(Array.isArray(e))return F(e)}(a)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(a)||function(e,t){if(e){if("string"==typeof e)return F(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?F(e,t):void 0}}(a)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).concat([G(n)]));return t[n]=i,i}}};function W(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a=[],i=!0,u=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){u=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(u)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return J(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?J(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function X(e,t){var r=S(),o=(0,n.useState)((function(){return function(e,t,r){try{var n=window.localStorage.getItem(e);if(n)return JSON.parse(n)}catch(e){r.onError(e)}return R(t)()}(e,t,r)})),a=W(o,2),i=a[0],u=a[1],l=(0,n.useCallback)((function(t){u((function(n){var o=R(t)(n);return function(e,t,r){try{var n=JSON.stringify(t);window.localStorage.setItem(e,n)}catch(e){r.onError(e)}}(e,o,r),o}))}),[r]);return[i,l]}function q(){return(0,n.useMemo)(V)}function Z(e,t,r){var o=(0,n.useCallback)((function(t){return r((n=R(t),function(e){return e((function(e){return n}))(B)})(e));var n}),[e,r]),a=function(e){return e((function(e){return _}))(H)}(e)(t);return[a,o]}var z=["position"],K=["loadOptions"],Y=["value","options","defaultLabel","onChange"];function Q(){return Q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Q.apply(this,arguments)}function ee(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function te(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a=[],i=!0,u=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){u=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(u)throw o}}return a}}(e,t)||re(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function re(e,t){if(e){if("string"==typeof e)return ne(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ne(e,t):void 0}}function ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function oe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ae(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(r),!0).forEach((function(t){ie(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ie(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ue=4096;function le(e){var t=e.settings,r=e.onChange,o=(null==t?void 0:t.deviceId)||"",a=q(),i=te(Z(a.deviceId,t,r),2),u=i[0],l=i[1],c=te(Z(a.byDeviceId[o].width,t,r),2),f=c[0],s=c[1],p=te(Z(a.byDeviceId[o].height,t,r),2),m=p[0],v=p[1];return n.createElement(n.Fragment,null,n.createElement("section",{className:"fieldSetLike"},n.createElement("h6",null,"Camera:"),n.createElement(ce,{value:u,onChange:l}),n.createElement("section",{className:"labelLike"},n.createElement("h6",null,"Width:"),n.createElement(ve,{value:f,onChange:s})),n.createElement("section",{className:"labelLike"},n.createElement("h6",null,"Height:"),n.createElement(ve,{value:m,onChange:v}))))}function ce(e){var t=e.value,r=e.onChange,o={menu:function(e){return e.position,ee(e,z)}},a=(0,n.useCallback)((function(e){return navigator.mediaDevices.enumerateDevices().then((function(e){return e.filter((function(e){return"videoinput"==e.kind})).map((function(e){return{value:e.deviceId,label:e.label||e.deviceId}}))}))}),[]);return n.createElement(fe,{className:"reactSelect","aria-label":"Video input device",isSearchable:!1,isClearable:!0,loadOptions:a,value:t,defaultLabel:(null==t?void 0:t.toString())||"Any",onChange:r,styles:o})}function fe(e){var t=e.loadOptions,r=ee(e,K),o=S(),a=te((0,n.useState)([]),2),i=a[0],u=a[1],l=te((0,n.useState)(0),2),c=l[0],f=l[1],s=(0,n.useCallback)((function(){f((function(e){return e+1})),o.wrapPromise(o.wrap(t)().then(u).finally((function(){return f((function(e){return e-1}))})))}),[t,o]);return(0,n.useEffect)(s,[t]),n.createElement(se,Q({options:i,onMenuOpen:s,isLoading:c},r))}function se(e){var t=e.value,r=e.options,o=e.defaultLabel,a=e.onChange,i=ee(e,Y),u=(0,n.useMemo)((function(){return function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_;return e.reduce((function(e,n){return I(I({},e),{},k({},t(n),r(n)))}),{})}(r,(function(e){return e.value}))}),[r]);return n.createElement(l.ZP,Q({options:r,value:u[t]||{value:t,label:o}},i,{onChange:function(e){return a(null==e?void 0:e.value)}}))}var pe=[4096,3840,3072,2880,2560,2304,2048,2160,1920,1600,1440,1280,1200,1024,1080,960,720,800,640,600,480];function me(e){return{exact:Boolean(null==e?void 0:e.exact),resolution:(null==e?void 0:e.exact)||(null==e?void 0:e.ideal)}}function ve(e){var t=e.value,r=e.onChange,o=me(t),a=(0,n.useCallback)((function(e){return r((function(t){return function(e){if(null!=e&&e.resolution)return null!=e&&e.exact?{exact:e.resolution}:{ideal:e.resolution}}(R(e)(me(t)))}))}),[r]),i=te((0,n.useState)(pe),2),u=i[0],l=i[1],s=q(),p=te(Z(s.exact,o,a),2),m=p[0],v=p[1],h=te(Z(s.resolution,o,a),2),d=h[0],y=h[1],g=(0,n.useCallback)((function(e){return parseInt(e)>0&&parseInt(e)<=ue}),[]),b=(0,n.useCallback)((function(e){var t=parseInt(e);l((function(e){return e.includes(t)?e:[].concat((r=e,function(e){if(Array.isArray(e))return ne(e)}(r)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||re(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),[t]).sort((function(e,t){return t-e}));var r})),y(t)}),[]);return n.createElement("div",{className:"resolutionSelector"},n.createElement(f.Z,{"aria-label":"Use exact resolution",checked:m,disabled:!d,icons:{checked:n.createElement("span",{className:"toggleSymbol"},"="),unchecked:n.createElement("span",{className:"toggleSymbol"},"≈")},onChange:function(e){return v(e.target.checked)}}),n.createElement(c.Z,{className:"resolution reactSelect","aria-label":"Resolution",isClearable:!0,value:{value:d,label:d||"Any"},onChange:function(e){return y(null==e?void 0:e.value)},options:u.map((function(e){return{value:e,label:e}})),isValidNewOption:g,onCreateOption:b}))}var he=r(3141),de=r(5600),ye=r(1437),ge=r(7160),be=r(7069),we=r(3162),Ee=r(3754),Oe=r(7948);function Se(e,t,r){return new Ee.Z(N(e).map((function(e){return N(t).map((function(t){return r(e,t)}))})))}function xe(e,t){return Se(e.rows,e.columns,(function(r,n){return r==n?t(e.get(r,n)):0}))}function Ce(e){var t;return!(e=null!==(t=e)&&void 0!==t?t:function(e){return e})instanceof Function?function(t){return e}:e}function je(){var e=Promise.resolve(),t=void 0;function r(){var e=t;return t=void 0,e()}return function(n){var o=t;t=n,o||(e=e.then((function(e){if(e)return e()})).then(r,r))}}function Ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Pe(e){var t=e.constraints,r=e.onFrame,o=(0,n.useRef)(),a=(0,n.useRef)();a.current=r;var i,u,l=(i=(0,n.useState)(je),u=1,function(e){if(Array.isArray(e))return e}(i)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a=[],i=!0,u=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){u=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(u)throw o}}return a}}(i,u)||function(e,t){if(e){if("string"==typeof e)return Ae(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ae(e,t):void 0}}(i,u)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],c=S(),f=(0,n.useRef)();f.current=c,(0,be.F_)((function(){l((function(){return c.wrapPromise(navigator.mediaDevices.getUserMedia(t).then((function(e){return o.current.srcObject=e,c.wrap((function(){return function(e){e&&e.getTracks().forEach((function(t){e.removeTrack(t),t.stop()}))}(e)}))})))}))}),[t,c]);var s=(0,n.useCallback)((function(e){var t;function r(r,n){if(o.current==e){try{a.current&&a.current(r,n,e)}catch(e){f.current.onError(e)}t()}}null!=e&&(o.current=e,(t=e.requestVideoFrameCallback?function(){return e.requestVideoFrameCallback(r)}:function(){return window.requestAnimationFrame((function(t){return r(t,{width:e.videoWidth,height:e.videoHeight})}))})())}),[]);return n.createElement("video",{ref:s,playsInline:!0,autoPlay:!0,className:"camera"})}var Te=r(2425);function Ie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ke(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ne="\n  attribute highp vec2 aTextureCoord;\n  \n  uniform highp vec4 uVertexPosition;\n    \n  varying highp vec2 vTextureCoord;\n  \n  void main(void) {\n    gl_Position = uVertexPosition;\n    gl_PointSize = 1.0;\n    vTextureCoord = aTextureCoord;\n  }\n",_e="\n  varying highp vec2 vTextureCoord;\n  \n  uniform highp mat3 uCoordMatrix;\n  uniform sampler2D uSampler;\n  uniform highp vec4 uChannelIndex;\n\n  void main(void) {\n    highp vec4 texelColor = texture2D(uSampler, vec2(uCoordMatrix * vec3(vTextureCoord, 1)));\n    \n    highp float channelValue = dot(uChannelIndex, vec4(texelColor.rgb, 1));\n    gl_FragColor = channelValue * vec4(texelColor.rgb, 1);\n  }\n",Me=[[-.75,0,0,1],[-.25,0,0,1],[.25,0,0,1],[.75,0,0,1]].map((function(e){return new Float32Array(e)})),Re=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]].map((function(e){return new Float32Array(e)}));function Fe(e,t){return 16==t?{type:e.HALF_FLOAT,internalFormat:e.RGBA16F,arrayType:function(e){return new Uint16Array(e)},view:function(e){return new Te.n(e.buffer)}}:{type:e.FLOAT,internalFormat:e.RGBA32F,arrayType:function(e){return new Float32Array(e)},view:function(e){return e}}}var De=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32;Ie(this,e),this.gl=t,this.nsamples=r,this.floatType=Fe(t,n),this.program=he.EK(t,[Ne,_e]),this.buffers=he.qX(t,{aTextureCoord:Array(2*r).fill(0).map((function(e){return Math.random()})),indices:N(r)}),this.textureSampler=he.bb(t,{minMag:t.NEAREST}),this.fb=he.pL(t,[{type:this.floatType.type,format:t.RGBA,internalFormat:this.floatType.internalFormat,min:t.NEAREST,mag:t.NEAREST,wrap:t.CLAMP_TO_EDGE}],4,1)}var t,r;return t=e,(r=[{key:"sample",value:function(e,t){var r=this.gl;for(var n in he.GG(r,this.fb),r.useProgram(this.program.program),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.disable(r.DEPTH_TEST),he.o8(r,this.program,this.buffers),r.blendFunc(r.ONE,r.ONE),r.enable(r.BLEND),N(4))he.N9(this.program,{uVertexPosition:Me[n],uCoordMatrix:t,uChannelIndex:Re[n],uSampler:{texture:e,sampler:this.textureSampler}}),r.drawElements(r.POINTS,this.nsamples,r.UNSIGNED_SHORT,0);var o=this.floatType.arrayType(16);return r.readBuffer(r.COLOR_ATTACHMENT0),r.readPixels(0,0,4,1,r.RGBA,this.floatType.type,o),r.blendFunc(r.ONE,r.ZERO),r.disable(r.BLEND),this.floatType.view(o)}}])&&ke(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Le(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ue=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gl=t,this.program=he.EK(t,["\n  attribute vec4 aVertexPosition;\n  attribute vec2 aTextureCoord;\n\n  uniform highp mat4 uPositionMatrix;\n\n  varying highp vec2 vTextureCoord;\n\n  void main(void) {\n    gl_Position = uPositionMatrix * aVertexPosition;\n    vTextureCoord = aTextureCoord;\n  }\n","\n  varying highp vec2 vTextureCoord;\n\n  uniform sampler2D uSampler;\n  uniform highp mat4 uColorMatrix;\n\n  void main(void) {\n    highp vec4 texelColor = texture2D(uSampler, vTextureCoord);\n\n    gl_FragColor = uColorMatrix * vec4(texelColor.rgb, 1);\n  }\n"]),this.buffers=he.qX(t,{aVertexPosition:[-1,-1,0,1,-1,0,1,1,0,-1,1,0],aTextureCoord:[0,1,1,1,1,0,0,0],indices:[0,1,2,0,2,3]})}var t,r;return t=e,r=[{key:"display",value:function(e,t,r,n,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=this.gl,l=u.canvas.getBoundingClientRect();i?(u.canvas.width=i.width,u.canvas.height=i.height):(u.canvas.width=l.width*window.devicePixelRatio,u.canvas.height=l.height*window.devicePixelRatio);var c=Math.max(r,n),f=r/c,s=n/c,p=a.Ue();p[0]=.5*f,p[5]=-.5*s;var m=Math.max(l.width,l.height),v=l.width/m,h=l.height/m,d=Math.max(u.canvas.width,u.canvas.height),y=u.canvas.width/d,g=u.canvas.height/d,b=Math.max(y/v,g/h),w=a.Ue();w[0]=2/y*b,w[5]=-2/g*b,o&&a.Jp(p,o,p),a.Jp(p,w,p),u.bindFramebuffer(u.FRAMEBUFFER,null),u.viewport(0,0,u.canvas.width,u.canvas.height),u.useProgram(this.program.program),u.clearColor(0,0,0,1),u.clear(u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT),u.enable(u.DEPTH_TEST),u.depthFunc(u.LEQUAL),he.o8(u,this.program,this.buffers),he.N9(this.program,{uPositionMatrix:p,uSampler:{texture:t},uColorMatrix:e}),u.drawElements(u.TRIANGLES,6,u.UNSIGNED_SHORT,0)}}],r&&Le(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Be(e){var t=S(),r=(0,n.useRef)();r.current=e;var o=e.decor,i=e.post,u=e.projection,l=e.videoConstraints,c=(0,n.useRef)(),f=(0,n.useRef)(),s=(0,n.useRef)(),p=(0,n.useCallback)(t.wrap((function(e){if(null!=e){c.current=e;var n=e.getContext("webgl2");if(!n)throw Error("Could not get webgl2 context");he.pV(n);var o=32;n.getExtension("EXT_color_buffer_float")||(n.getExtension("EXT_color_buffer_half_float")?o=16:t.onError(Error("Could not get WebGL extenstion EXT_color_buffer_float or EXT_color_buffer_half_float")));var i,u,l,p=he.cU(n,{mag:n.LINEAR,min:n.LINEAR,src:[0,0,255,255]}),m={width:1,height:1},v=!1,h=new De(n,1e3,o),d=new Ue(n),y=a.Ue();i=function(t){var o=r.current,i=o.decor,u=o.post,l=o.projection,c=o.captureSignal;s.current&&(n.bindTexture(n.TEXTURE_2D,p),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,s.current.camera),m=s.current.frame,v=!0,s.current=null);var f=a.Ue(),g=de.Ue(),b=m.width,w=m.height;if(l){var E=l(m.width/m.height);f=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return a.al(r,0,0,0,0,r*n,0,0,0,0,1,0,e,t,0,1)}(E.toScreen.x,E.toScreen.y,E.toScreen.scale);var O=E.screenBoundsInImage;de.Iu(g,g,ye.al(.5+O.left/E.imageWidth,.5+O.top/E.imageHeight));var S=(O.right-O.left)/E.imageWidth,x=(O.bottom-O.top)/E.imageHeight;de.bA(g,g,ye.al(S,x)),b=m.width*S,w=m.height*x}var C,j,A=a.Ue(),P=a.Ue();if(v){if(i){var T=h.sample(p,g),I=function(e,t){return T[4*e+t]};P=function(e,t,r){var n,o=null!==(n=r.corr)&&void 0!==n&&n,i=xe(e,Math.sqrt),u=xe(i,(function(e){return 1/e})),l=e;o&&(l=u.mmul(e).mmul(u));var c=new Oe.Z(l),f=xe(c.diagonalMatrix,(function(e){return 1/Math.sqrt(e)})),s=Ce(r.sigma)(i).mmul(c.eigenvectorMatrix).mmul(f).mmul(c.eigenvectorMatrix.transpose());o&&(s=s.mmul(u));var p=function(e){return t=function(t,r){return t<e.rows&&r<e.columns?e.get(t,r):t==r?1:0},a.al(t(0,0),t(1,0),t(2,0),t(3,0),t(0,1),t(1,1),t(2,1),t(3,1),t(0,2),t(1,2),t(2,2),t(3,2),t(0,3),t(1,3),t(2,3),t(3,3));var t}(s),m=t.map((function(e){return-1*e})),v=Ce(r.mean)(t),h=a.Ue();a.vc(h,m);var d=a.Ue();return a.vc(d,v),a.Jp(p,p,h),a.Jp(p,d,p),p}((j=(C=I)(3,3),Se(3,3,(function(e,t){return(C(e,t)-C(e,3)*C(3,t)/j)/(j-1)}))),ge.al(I(0,3)/I(3,3),I(1,3)/I(3,3),I(2,3)/I(3,3)),i),P.some(isNaN)?P=y:y=P}u?a.Jp(A,u,P):A=P}var k,N=c();N&&(k={width:b,height:w}),d.display(A,p,m.width,m.height,f,k),N&&e.toBlob((function(e){(0,we.saveAs)(e,N.fileName)}),N.type)},u=void 0,l=function(e){if(e!=u){u=e;for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return i.apply(void 0,[e].concat(r))}},f.current=l}})),[]);function m(){f.current&&window.requestAnimationFrame(t.wrap(f.current))}return(0,be.F_)(m,[o,i,u]),n.createElement(n.Fragment,null,n.createElement("canvas",{ref:p,className:"contrast maximal"}),n.createElement(Pe,{constraints:{audio:!1,video:l},onFrame:function(e,t,r){s.current={frame:t,camera:r},m()}}))}function He(e){var t=e.getBoundingClientRect(),r=document.body,n=document.documentElement,o=window.pageYOffset||n.scrollTop||r.scrollTop,a=window.pageXOffset||n.scrollLeft||r.scrollLeft,i=n.clientTop||r.clientTop||0,u=n.clientLeft||r.clientLeft||0,l=t.top+o-i,c=t.left+a-u;return{x:Math.round(c),y:Math.round(l),width:t.width,height:t.height}}function Ge(e,t){var r=He(e),n=Math.max(r.height,r.width);return{x:(t.center.x-(r.x+r.width/2))/n,y:(t.center.y-(r.y+r.height/2))/n}}var Ve=function(e){return e>1?{width:1,height:1/e}:{width:e,height:1}};function $e(e,t,r){if(e>=t)return 0;var n,o,a,i=t/2-e/2;return n=-i,o=r,a=i,Math.max(n,Math.min(o,a))}function We(e,t){var r=t.x,n=t.y;return{x:r*e.scale+e.x,y:n*e.scale+e.y}}function Je(e){var t=e.x,r=e.y,n=e.scale;return{x:-t/n,y:-r/n,scale:1/n}}function Xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var qe={value:"image/jpeg",label:"JPEG",extension:".jpg"},Ze={value:"image/png",label:"PNG",extension:".png"};function ze(e){var t=e.value,r=e.onChange;return n.createElement(l.ZP,{className:"reactSelect",isSearchable:!1,value:t,options:[qe,Ze],onChange:r})}function Ke(e){var t=e.children,r=e.value,o=e.onChange;return n.createElement("label",{className:"inline"},t,n.createElement(f.Z,{checked:!!r,onChange:function(e){return o(e.target.checked)}}))}function Ye(e){var t,r,o=e.value,a=e.onChange,i=(t=Z(q().displayCamera,o,a),r=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a=[],i=!0,u=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){u=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(u)throw o}}return a}}(t,r)||function(e,t){if(e){if("string"==typeof e)return Xe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Xe(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=i[0],l=i[1];return n.createElement("details",{className:"debugSettings fieldSetLike"},n.createElement("summary",null,"Debug settings:"),n.createElement("div",null,n.createElement(Ke,{value:u,onChange:l},"Show camera:")))}var Qe=r(4184),et=r.n(Qe);function tt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function rt(e){var t,r,o=e.children,a=(t=(0,n.useState)(),r=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a=[],i=!0,u=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){u=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(u)throw o}}return a}}(t,r)||function(e,t){if(e){if("string"==typeof e)return tt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?tt(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=a[0],u=a[1];return(0,n.useEffect)((function(){var e=new AbortController;return window.addEventListener("beforeinstallprompt",(function(e){e.preventDefault(),u(e)}),{signal:e.signal}),e.abort}),[]),i?n.createElement("button",{onClick:function(){i.prompt(),u(null)}},o):null}function nt(){return nt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},nt.apply(this,arguments)}function ot(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a=[],i=!0,u=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){u=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(u)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return at(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?at(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function at(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var it=a.al(-1,0,0,0,0,-1,0,0,0,0,-1,0,1,1,1,1),ut=[{decor:{}},{},{post:it},{decor:{},post:it}],lt=function(e){return(e+1)%ut.length},ct=function(e){return(e+ut.length-1)%ut.length};function ft(e){var t=e.filePrefix,r=void 0===t?"Contrast Visor capture":t,o=ot((0,n.useState)(!1),2),a=o[0],i=o[1],l=ot((0,n.useState)(0),2),c=l[0],f=l[1],s=ot((0,n.useState)(),2),p=s[0],m=s[1],v=ot(X("contrast-visor.settings.camera",{}),2),h=v[0],d=v[1],y=ot(X("contrast-visor.settings.imageFormat",Ze),2),g=y[0],b=y[1],w=ot(X("contrast-visor.settings.renderCamera",!1),2),E=w[0],O=w[1],S=function(){var e=W((0,n.useState)(),2),t=e[0],r=e[1],o=(0,n.useCallback)((function(e){r({set:!0,signal:e})}));return[(0,n.useCallback)((function(){if(null!=t&&t.set){t.set=!1;var e=t.signal;return t.signal=null,e}}),[t]),o]}(),j=ot(S,2),P=j[0],T=j[1],I=ot((0,n.useState)(),2),k=I[0],N=I[1],_=function(e){var t,r={width:{max:ue},height:{max:ue}};null!=e&&e.deviceId&&(r.deviceId={exact:e.deviceId});var n=null==e||null===(t=e.byDeviceId)||void 0===t?void 0:t[(null==e?void 0:e.deviceId)||""];return null!=n&&n.width&&(r.width=ae(ae({},n.width),r.width)),null!=n&&n.height&&(r.height=ae(ae({},n.height),r.height)),r}(h),M=et()("wrapper","maximal",{settingsOpen:a}),R=ut[c%ut.length],F=ot((0,n.useState)({}),1)[0];F.tap=(0,n.useCallback)((function(){T({type:g.value,fileName:r+" "+(new Date).toJSON().replace("T"," ").replaceAll(":",".")+g.extension})}),[g,r]);var D=(0,n.useCallback)((function(e){if(null!=e){var t,r=new(u().Manager)(e,{recognizers:[[u().Tap,{taps:2}],[u().Swipe],[u().Pinch]],touchAction:"none"});r.on("tap",(function(){return F.tap()})),o("swipeleft","swipedown",(function(){return i(!0)}),(function(){return f(lt)})),o("swiperight","swipeup",(function(){return i(!1)}),(function(){return f(ct)})),function(e,t,r){var n={x:0,y:0,scale:1},o=void 0,a=void 0;function i(t,r){var o,a,i=He(e),u=i.width/i.height,l=Ve(u),c=l.width,f=l.height,s=Ve(r),p=s.width,m=s.height,v=Math.min(c/p,f/m),h={x:0,y:0,scale:v},d=t.scale*v,y=$e(c,p*d,t.x),g=$e(f,m*d,t.y),b=(a=h,{x:(o=n={x:y,y:g,scale:t.scale}).scale*a.x+o.x,y:o.scale*a.y+o.y,scale:o.scale*a.scale}),w=Je(b),E=We(w,{x:-c/2,y:-f/2}),O=We(w,{x:c/2,y:f/2});return{toScreen:b,screenBoundsInImage:{left:Math.max(-p/2,E.x),right:Math.min(p/2,O.x),top:Math.max(-m/2,E.y),bottom:Math.min(m/2,O.y)},imageWidth:p,imageHeight:m}}t.on("pinchstart",(function(t){var r=Ge(e,t);a=We(Je(n),r),o=n})),t.on("pinch",(function(t){var n=Ge(e,t),u=Math.max(t.scale*o.scale,1),l={x:n.x-a.x*u,y:n.y-a.y*u,scale:u};r((function(e){return i(l,e)}))})),r((function(e){return i(n,e)}))}(e,r,(t=m,function(e){return t((function(){return e}))}))}function n(){return window.getComputedStyle(e).getPropertyValue("--cv-horizontal-layout")}function o(e,t,o,a){r.on(e,(function(){return n()?o():a()})),r.on(t,(function(){return n()?a():o()}))}}),[]);return n.createElement("div",{className:M},n.createElement("div",{ref:D,className:et()("screen","maximal",{displayCamera:null==k?void 0:k.displayCamera,renderCamera:E})},n.createElement(C,null,n.createElement(Be,nt({videoConstraints:_,projection:p},R,{captureSignal:P})))),n.createElement("div",{className:"panel"},n.createElement("div",{className:"settings"},n.createElement("h1",null,"Contrast Visor ",n.createElement("span",{className:"versionNumber"},"0.4.8")),n.createElement(le,{settings:h,onChange:d}),n.createElement("label",null,"Image format:",n.createElement(ze,{value:g,onChange:b})),n.createElement(Ke,{value:E,onChange:O},"Render camera (iOS):"),n.createElement(rt,null,"Install"),n.createElement(Ye,{value:k,onChange:N}),n.createElement(x.Consumer,null,(function(e){return n.createElement(A,{errors:e})})))))}function st(e){var t=S();return n.createElement(C,null,n.createElement(j,{chainErrorHandler:t},n.createElement(ft,e)))}r(1066),r(6140),document.getElementById("errors"),document.getElementById("downloader"),o.render(n.createElement(st,null),document.getElementById("root")),"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("sw.js",{scope:"."}).then((function(e){console.log("SW registered: ",e)})).catch((function(e){console.log("SW registration failed: ",e)}))}))},1066:(e,t,r)=>{e.exports=r.p+"imgs\\eye162.png"},6140:(e,t,r)=>{e.exports=r.p+"manifest.webmanifest"}},r={};function n(e){var o=r[e];if(void 0!==o)return o.exports;var a=r[e]={id:e,exports:{}};return t[e].call(a.exports,a,a.exports,n),a.exports}n.m=t,e=[],n.O=(t,r,o,a)=>{if(!r){var i=1/0;for(f=0;f<e.length;f++){for(var[r,o,a]=e[f],u=!0,l=0;l<r.length;l++)(!1&a||i>=a)&&Object.keys(n.O).every((e=>n.O[e](r[l])))?r.splice(l--,1):(u=!1,a<i&&(i=a));if(u){e.splice(f--,1);var c=o();void 0!==c&&(t=c)}}return t}a=a||0;for(var f=e.length;f>0&&e[f-1][2]>a;f--)e[f]=e[f-1];e[f]=[r,o,a]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),(()=>{var e={179:0};n.O.j=t=>0===e[t];var t=(t,r)=>{var o,a,[i,u,l]=r,c=0;if(i.some((t=>0!==e[t]))){for(o in u)n.o(u,o)&&(n.m[o]=u[o]);if(l)var f=l(n)}for(t&&t(r);c<i.length;c++)a=i[c],n.o(e,a)&&e[a]&&e[a][0](),e[i[c]]=0;return n.O(f)},r=self.webpackChunkcontrastvisor=self.webpackChunkcontrastvisor||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var o=n.O(void 0,[216],(()=>n(7930)));o=n.O(o)})();