(()=>{"use strict";var e,t={580:(e,t,n)=>{var r=n(141),o=n(975),i=n(160),a=n(840),u=n.n(a),l=n(754),c=n(948),s=function(e){return Array(e).fill().map((function(e,t){return t}))};function h(e,t,n){return new l.Z(s(e).map((function(e){return s(t).map((function(t){return n(e,t)}))})))}function d(e,t){return h(e.rows,e.columns,(function(n,r){return n==r?t(e.get(n,r)):0}))}function p(e){var t;return!(e=null!==(t=e)&&void 0!==t?t:function(e){return e})instanceof Function?function(t){return e}:e}var m=n(294),f=n(935);function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var g=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onError=console.log,this.container=document.body.appendChild(document.createElement("div")),this.current=null,this.currentFrame=null,this.mockFrame=null,this.changing=!1,this.nextConstraints=null,this.callbacks=[]}var t,n;return t=e,n=[{key:"requestVideoFrameCallback",value:function(e){this.callbacks.push(e)}},{key:"videoFrameCallback",value:function(e,t){this.currentFrame=t;var n=this.callbacks;this.callbacks=[],n.forEach((function(n){return n(e,t)})),this.watch()}},{key:"watch",value:function(){var e=this;this.current&&(this.current.requestVideoFrameCallback?this.current.requestVideoFrameCallback((function(t,n){return e.videoFrameCallback(t,n)})):requestAnimationFrame((function(t){return e.videoFrameCallback(t,e.mockFrame)})))}},{key:"change",value:function(e){this.nextConstraints=e,this.changing||this.startChange()}},{key:"startChange",value:function(){var e=this;this.changing=!0;var t=this.nextConstraints;this.nextConstraints=null,navigator.mediaDevices.getUserMedia(t).then((function(t){return e.setStream(t)})).catch(this.onError).then((function(){e.changing=!1,e.nextConstraints&&e.startChange()}))}},{key:"setStream",value:function(e){var t=this;for(this.currentFrame=null,this.mockFrame=null,this.current&&(this.current.srcObject.getTracks().forEach((function(e){return e.stop()})),this.current.srcObject=null),this.current=null;this.container.firstChild;)this.container.removeChild(this.container.firstChild);f.unmountComponentAtNode(this.container);var n=f.render(m.createElement("video",{playsInline:!0,autoPlay:!0,style:{display:"none"}}),this.container);n.onloadedmetadata=function(e){t.mockFrame={width:n.videoWidth,height:n.videoHeight},console.log([n.videoWidth,n.videoHeight,"Camera"])},n.srcObject=e,this.current=n,this.watch()}},{key:"capture",value:function(e,t){this.currentFrame&&(e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.current))}}],n&&v(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var w=[[-.75,0,0,1],[-.25,0,0,1],[.25,0,0,1],[.75,0,0,1]].map((function(e){return new Float32Array(e)})),C=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]].map((function(e){return new Float32Array(e)})),E=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gl=t,this.nsamples=n,this.program=r.EK(t,["\n  attribute highp vec2 aTextureCoord;\n  \n  uniform highp vec4 uVertexPosition;\n    \n  varying highp vec2 vTextureCoord;\n  \n  void main(void) {\n    gl_Position = uVertexPosition;\n    gl_PointSize = 1.0;\n    vTextureCoord = aTextureCoord;\n  }\n","\n  varying highp vec2 vTextureCoord;\n  \n  uniform sampler2D uSampler;\n  uniform highp vec4 uChannelIndex;\n\n  void main(void) {\n    highp vec4 texelColor = texture2D(uSampler, vTextureCoord);\n    \n    highp float channelValue = dot(uChannelIndex, vec4(texelColor.rgb, 1));\n    gl_FragColor = channelValue * vec4(texelColor.rgb, 1);\n  }\n"]),this.buffers=r.qX(t,{aTextureCoord:Array(2*n).fill(0).map((function(e){return Math.random()})),indices:s(n)}),this.textureSampler=r.bb(t,{minMag:t.NEAREST}),this.fb=r.pL(t,[{type:t.FLOAT,format:t.RGBA,internalFormat:t.RGBA32F,min:t.NEAREST,mag:t.NEAREST,wrap:t.CLAMP_TO_EDGE}],4,1)}var t,n;return t=e,(n=[{key:"sample",value:function(e){var t=this.gl;for(var n in r.GG(t,this.fb),t.useProgram(this.program.program),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.disable(t.DEPTH_TEST),r.o8(t,this.program,this.buffers),t.blendFunc(t.ONE,t.ONE),t.enable(t.BLEND),s(4))r.N9(this.program,{uVertexPosition:w[n],uChannelIndex:C[n],uSampler:{texture:e,sampler:this.textureSampler}}),t.drawElements(t.POINTS,this.nsamples,t.UNSIGNED_SHORT,0);var o=new Float32Array(16);return t.readBuffer(t.COLOR_ATTACHMENT0),t.readPixels(0,0,4,1,t.RGBA,t.FLOAT,o),t.blendFunc(t.ONE,t.ZERO),t.disable(t.BLEND),o}}])&&b(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var y=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gl=t,this.program=r.EK(t,["\n  attribute vec4 aVertexPosition;\n  attribute vec2 aTextureCoord;\n\n  uniform highp mat4 uPositionMatrix;\n\n  varying highp vec2 vTextureCoord;\n\n  void main(void) {\n    gl_Position = uPositionMatrix * aVertexPosition;\n    vTextureCoord = aTextureCoord;\n  }\n","\n  varying highp vec2 vTextureCoord;\n\n  uniform sampler2D uSampler;\n  uniform highp mat4 uColorMatrix;\n\n  void main(void) {\n    highp vec4 texelColor = texture2D(uSampler, vTextureCoord);\n\n    gl_FragColor = uColorMatrix * vec4(texelColor.rgb, 1);\n  }\n"]),this.buffers=r.qX(t,{aVertexPosition:[-1,-1,0,1,-1,0,1,1,0,-1,1,0],aTextureCoord:[0,1,1,1,1,0,0,0],indices:[0,1,2,0,2,3]})}var t,n;return t=e,(n=[{key:"display",value:function(e,t,n,i){var a=this.gl,u=a.canvas.getBoundingClientRect(),l=Math.min(1,u.width*window.devicePixelRatio/n,u.height*window.devicePixelRatio/i);a.canvas.width=n*l,a.canvas.height=i*l,a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,a.canvas.width,a.canvas.height),a.useProgram(this.program.program),a.clearColor(0,0,0,1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),a.enable(a.DEPTH_TEST),a.depthFunc(a.LEQUAL),r.o8(a,this.program,this.buffers);var c=o.Ue();r.N9(this.program,{uPositionMatrix:c,uSampler:{texture:t},uColorMatrix:e}),a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0)}}])&&x(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),T=(n(66),n(140),new g),F=document.getElementById("screen"),k=document.getElementById("errors"),O=document.getElementById("downloader");function P(e){console.log(e);var t=document.createElement("div"),n=document.createTextNode(e);t.appendChild(n),k.appendChild(t)}T.onError=P;var A=o.al(-1,0,0,0,0,-1,0,0,0,0,-1,0,1,1,1,1),S=0,R=[{decor:{}},{},{post:A},{decor:{},post:A}];function _(){S=(S+1)%R.length}function N(){S=(S+R.length-1)%R.length}T.change({audio:!1,video:{width:{ideal:4096,max:4096},height:{ideal:4096,max:4096},facingMode:{ideal:"environment"}}});var B=function(){var e=F.getContext("webgl2");r.pV(e),e.getExtension("EXT_float_blend")||P("Could not get WebGL extenstion EXT_float_blend");var t=r.cU(e,{mag:e.LINEAR,min:e.LINEAR,src:[0,0,255,255]}),n={width:1,height:1},a=o.Ue(),u=new E(e,1e3),l=new y(e);return function r(s,m){if(m){n=m,T.capture(e,t);var f=u.sample(t),v=function(e,t){return f[4*e+t]},g=(E=(C=v)(3,3),h(3,3,(function(e,t){return(C(e,t)-C(e,3)*C(3,t)/E)/(E-1)}))),b=i.al(v(0,3)/v(3,3),v(1,3)/v(3,3),v(2,3)/v(3,3)),w=o.Ue();R[S].decor&&(w=function(e,t,n){var r,i=null!==(r=n.corr)&&void 0!==r&&r,a=d(e,Math.sqrt),u=d(a,(function(e){return 1/e})),l=e;i&&(l=u.mmul(e).mmul(u));var s=new c.Z(l),h=d(s.diagonalMatrix,(function(e){return 1/Math.sqrt(e)})),m=p(n.sigma)(a).mmul(s.eigenvectorMatrix).mmul(h).mmul(s.eigenvectorMatrix.transpose());i&&(m=m.mmul(u));var f,v,g=(f=m,v=function(e,t){return e<f.rows&&t<f.columns?f.get(e,t):e==t?1:0},o.al(v(0,0),v(1,0),v(2,0),v(3,0),v(0,1),v(1,1),v(2,1),v(3,1),v(0,2),v(1,2),v(2,2),v(3,2),v(0,3),v(1,3),v(2,3),v(3,3))),b=t.map((function(e){return-1*e})),w=p(n.mean)(t),C=o.Ue();o.vc(C,b);var E=o.Ue();return o.vc(E,w),o.Jp(g,g,C),o.Jp(g,E,g),g}(g,b,R[S].decor)),R[S].post&&o.Jp(w,R[S].post,w),a=w}var C,E;l.display(a,t,n.width,n.height),T.requestVideoFrameCallback(r)}}();requestAnimationFrame((function(e){return B(e,null)}));var D,M=new(u().Manager)(F,{recognizers:[[u().Tap],[u().Swipe]],touchAction:"pinch-zoom"});M.on("tap",(function(e){B(null,null),function(e,t){O.setAttribute("download","Contrast Visor capture "+(new Date).toJSON().replace("T"," ").replaceAll(":",".")+".png"),O.setAttribute("href",e.toDataURL("image/png").replace("image/png","image/octet-stream")),O.click()}(F)})),M.on("swipeleft",_),M.on("swipeup",_),M.on("swipedown",N),M.on("swiperight",N),"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("service-worker.js",{scope:"."}).then((function(e){console.log("SW registered: ",e)})).catch((function(e){console.log("SW registration failed: ",e)}))}));var U=document.querySelector(".add-button");U.style.display="none",window.addEventListener("beforeinstallprompt",(function(e){e.preventDefault(),D=e,U.style.display="block",U.addEventListener("click",(function(){U.style.display="none",D.prompt(),D.userChoice.then((function(e){"accepted"===e.outcome?console.log("User accepted the web prompt"):console.log("User dismissed the web prompt"),D=null}))}))}))},66:(e,t,n)=>{e.exports=n.p+"imgs\\eye162.png"},140:(e,t,n)=>{e.exports=n.p+"manifest.webmanifest"}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var i=n[e]={exports:{}};return t[e](i,i.exports,r),i.exports}r.m=t,e=[],r.O=(t,n,o,i)=>{if(!n){var a=1/0;for(s=0;s<e.length;s++){for(var[n,o,i]=e[s],u=!0,l=0;l<n.length;l++)(!1&i||a>=i)&&Object.keys(r.O).every((e=>r.O[e](n[l])))?n.splice(l--,1):(u=!1,i<a&&(a=i));if(u){e.splice(s--,1);var c=o();void 0!==c&&(t=c)}}return t}i=i||0;for(var s=e.length;s>0&&e[s-1][2]>i;s--)e[s]=e[s-1];e[s]=[n,o,i]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),(()=>{var e={179:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var o,i,[a,u,l]=n,c=0;if(a.some((t=>0!==e[t]))){for(o in u)r.o(u,o)&&(r.m[o]=u[o]);if(l)var s=l(r)}for(t&&t(n);c<a.length;c++)i=a[c],r.o(e,i)&&e[i]&&e[i][0](),e[a[c]]=0;return r.O(s)},n=self.webpackChunkcontrastvisor=self.webpackChunkcontrastvisor||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var o=r.O(void 0,[216],(()=>r(580)));o=r.O(o)})();