(()=>{"use strict";var e,t={262:(e,t,r)=>{var n=r(294),o=r(935),a=r(975),i=r(797),u=r.n(i),l=r(122);function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a=[],i=!0,u=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){u=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(u)throw o}}return a}}(e,t)||f(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){if(e){if("string"==typeof e)return p(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(e,t):void 0}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function v(e,t){if(t&&("object"===c(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function g(e,t,r){return t&&y(e.prototype,t),r&&y(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var b={onError:console.error},w=function(){function e(t){d(this,e),this.errorHandler=t}return g(e,[{key:"onError",value:function(){var e;(e=this.errorHandler).onError.apply(e,arguments)}},{key:"wrapPromise",value:function(e){var t=this;return e.catch((function(e){if(e instanceof Error)t.errorHandler.onError(e);else try{throw new Error("Promise rejected with reason "+(null==e?void 0:e.toString()))}catch(e){t.errorHandler.onError(e)}return Promise.reject(e)}))}},{key:"wrap",value:function(e){var t=this;return function(){try{return e.apply(void 0,arguments)}catch(e){throw t.errorHandler.onError(e),e}}}}]),e}(),E=n.createContext(new w(b)),x=function(){return(0,n.useContext)(E)},O=n.createContext([]),S=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(a,e);var t,r,o=(t=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=m(t);if(r){var o=m(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return v(this,e)});function a(e){var t;return d(this,a),(t=o.call(this,e)).state={error:null,errorInfo:null},t}return g(a,[{key:"componentDidCatch",value:function(e,t){this.setState({error:e,errorInfo:t})}},{key:"render",value:function(){return this.state.errorInfo?n.createElement(P,{error:this.state.error,details:this.state.errorInfo.componentStack}):this.props.children}}]),a}(n.Component);function C(e){var t=e.children,r=e.chainErrorHandler,o=s((0,n.useState)([]),2),a=o[0],i=o[1],u=(0,n.useMemo)((function(){return new w({onError:function(e){i((function(t){return[].concat(function(e){if(Array.isArray(e))return p(e)}(r=t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||f(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[e]);var r})),r&&r.onError(e)}})}),[r]);return n.createElement(O.Provider,{value:a},n.createElement(E.Provider,{value:u},t))}function T(e){var t=e.children,r=e.chainErrorHandler,o=s((0,n.useState)(),2),a=o[0],i=o[1],u=(0,n.useCallback)((function(e){if(null!=e&&e.length)return a?n.createElement("div",{style:{position:"absolute",top:0,left:0,bottom:0,right:0,background:"white"}},n.createElement(j,{errors:e}),n.createElement("button",{onClick:function(){return i(!1)}},"X")):n.createElement("button",{style:{position:"absolute",bottom:0,right:0},onClick:function(){return i(!0)}},"Errors!")}),[a]);return n.createElement(C,{chainErrorHandler:r},t,n.createElement(O.Consumer,null,u))}function j(e){var t=e.errors;return n.createElement("div",{className:"errorLog"},t.map((function(e){return n.createElement(P,{error:e})})))}function P(e){var t=e.error,r=e.details;return null!=t&&t.stack||r?n.createElement("details",{className:"errorLogEntry"},n.createElement("summary",null,null==t?void 0:t.toString()),(null==t?void 0:t.stack)&&n.createElement("div",{className:"stackTrace"},null==t?void 0:t.stack),r&&n.createElement("div",{className:"details"},r)):n.createElement("div",{className:"errorLogEntry"},null==t?void 0:t.toString())}function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function I(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A(Object(r),!0).forEach((function(t){_(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var M=function(e){return Array(e).fill().map((function(e,t){return t}))},R=function(e){return e},k=["deviceId"],F=["position"];function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function D(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function U(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(Object(r),!0).forEach((function(t){L(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function L(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var H={width:{ideal:4096,max:4096},height:{ideal:4096,max:4096}};function G(e){var t,r=e.constraints,o=e.onChange;return n.createElement("label",null,"Camera:",n.createElement(V,{value:null==r||null===(t=r.deviceId)||void 0===t?void 0:t.exact,onChange:function(e){o(e?function(t){return U(U({},t),{},{deviceId:{exact:e}})}:function(e){return e.deviceId,D(e,k)})}}))}function V(e){var t,r,o,a=e.value,i=e.onChange,u=x(),c={menu:function(e){return e.position,D(e,F)}},s=(r=(0,n.useState)({}),o=2,function(e){if(Array.isArray(e))return e}(r)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a=[],i=!0,u=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){u=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(u)throw o}}return a}}(r,o)||function(e,t){if(e){if("string"==typeof e)return N(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?N(e,t):void 0}}(r,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),f=s[0],p=s[1];return n.createElement(l.Z,{isSearchable:!1,isClearable:!0,loadOptions:function(e){var t=navigator.mediaDevices.enumerateDevices().then((function(e){return e.filter((function(e){return"videoinput"==e.kind})).map((function(e){return{value:e.deviceId,label:e.label||e.deviceId}}))}));return u.wrapPromise(t.then((function(e){return p(function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R;return e.reduce((function(e,n){return I(I({},e),{},_({},t(n),r(n)))}),{})}(e,(function(e){return e.value})))}))),t},defaultOptions:!0,value:{value:a,label:a?null===(t=f[a])||void 0===t?void 0:t.label:"Any"},onChange:function(e){return i(null==e?void 0:e.value)},styles:c})}var X=r(141),J=r(600),W=r(437),$=r(160),q=r(69),Z=r(162),z=r(754),K=r(948);function Y(e,t,r){return new z.Z(M(e).map((function(e){return M(t).map((function(t){return r(e,t)}))})))}function Q(e,t){return Y(e.rows,e.columns,(function(r,n){return r==n?t(e.get(r,n)):0}))}function ee(e){var t;return!(e=null!==(t=e)&&void 0!==t?t:function(e){return e})instanceof Function?function(t){return e}:e}function te(){var e=Promise.resolve(),t=void 0;function r(){var e=t;return t=void 0,e()}return function(n){var o=t;t=n,o||(e=e.then((function(e){if(e)return e()})).then(r,r))}}function re(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ne(e){var t=e.constraints,r=e.onFrame,o=(0,n.useRef)(),a=(0,n.useRef)();a.current=r;var i,u,l=(i=(0,n.useState)(te),u=1,function(e){if(Array.isArray(e))return e}(i)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a=[],i=!0,u=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){u=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(u)throw o}}return a}}(i,u)||function(e,t){if(e){if("string"==typeof e)return re(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?re(e,t):void 0}}(i,u)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],c=x(),s=(0,n.useRef)();s.current=c,(0,q.F_)((function(){l((function(){return c.wrapPromise(navigator.mediaDevices.getUserMedia(t).then((function(e){return o.current.srcObject=e,c.wrap((function(){return function(e){e&&e.getTracks().forEach((function(t){e.removeTrack(t),t.stop()}))}(e)}))})))}))}),[t,c]);var f=(0,n.useCallback)((function(e){function t(t,n){if(o.current==e){try{a.current&&a.current(t,n,e)}catch(e){s.current.onError(e)}r()}}function r(){e.requestVideoFrameCallback(t)}o.current=e,r()}),[]);return n.createElement("video",{ref:f,playsInline:!0,autoPlay:!0,style:{display:"none"}})}var oe=r(425);function ae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ie(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ue="\n  attribute highp vec2 aTextureCoord;\n  \n  uniform highp vec4 uVertexPosition;\n    \n  varying highp vec2 vTextureCoord;\n  \n  void main(void) {\n    gl_Position = uVertexPosition;\n    gl_PointSize = 1.0;\n    vTextureCoord = aTextureCoord;\n  }\n",le="\n  varying highp vec2 vTextureCoord;\n  \n  uniform highp mat3 uCoordMatrix;\n  uniform sampler2D uSampler;\n  uniform highp vec4 uChannelIndex;\n\n  void main(void) {\n    highp vec4 texelColor = texture2D(uSampler, vec2(uCoordMatrix * vec3(vTextureCoord, 1)));\n    \n    highp float channelValue = dot(uChannelIndex, vec4(texelColor.rgb, 1));\n    gl_FragColor = channelValue * vec4(texelColor.rgb, 1);\n  }\n",ce=[[-.75,0,0,1],[-.25,0,0,1],[.25,0,0,1],[.75,0,0,1]].map((function(e){return new Float32Array(e)})),se=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]].map((function(e){return new Float32Array(e)}));function fe(e,t){return 16==t?{type:e.HALF_FLOAT,internalFormat:e.RGBA16F,arrayType:function(e){return new Uint16Array(e)},view:function(e){return new oe.n(e.buffer)}}:{type:e.FLOAT,internalFormat:e.RGBA32F,arrayType:function(e){return new Float32Array(e)},view:function(e){return e}}}var pe=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32;ae(this,e),this.gl=t,this.nsamples=r,this.floatType=fe(t,n),this.program=X.EK(t,[ue,le]),this.buffers=X.qX(t,{aTextureCoord:Array(2*r).fill(0).map((function(e){return Math.random()})),indices:M(r)}),this.textureSampler=X.bb(t,{minMag:t.NEAREST}),this.fb=X.pL(t,[{type:this.floatType.type,format:t.RGBA,internalFormat:this.floatType.internalFormat,min:t.NEAREST,mag:t.NEAREST,wrap:t.CLAMP_TO_EDGE}],4,1)}var t,r;return t=e,(r=[{key:"sample",value:function(e,t){var r=this.gl;for(var n in X.GG(r,this.fb),r.useProgram(this.program.program),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.disable(r.DEPTH_TEST),X.o8(r,this.program,this.buffers),r.blendFunc(r.ONE,r.ONE),r.enable(r.BLEND),M(4))X.N9(this.program,{uVertexPosition:ce[n],uCoordMatrix:t,uChannelIndex:se[n],uSampler:{texture:e,sampler:this.textureSampler}}),r.drawElements(r.POINTS,this.nsamples,r.UNSIGNED_SHORT,0);var o=this.floatType.arrayType(16);return r.readBuffer(r.COLOR_ATTACHMENT0),r.readPixels(0,0,4,1,r.RGBA,this.floatType.type,o),r.blendFunc(r.ONE,r.ZERO),r.disable(r.BLEND),this.floatType.view(o)}}])&&ie(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function he(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ve=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gl=t,this.program=X.EK(t,["\n  attribute vec4 aVertexPosition;\n  attribute vec2 aTextureCoord;\n\n  uniform highp mat4 uPositionMatrix;\n\n  varying highp vec2 vTextureCoord;\n\n  void main(void) {\n    gl_Position = uPositionMatrix * aVertexPosition;\n    vTextureCoord = aTextureCoord;\n  }\n","\n  varying highp vec2 vTextureCoord;\n\n  uniform sampler2D uSampler;\n  uniform highp mat4 uColorMatrix;\n\n  void main(void) {\n    highp vec4 texelColor = texture2D(uSampler, vTextureCoord);\n\n    gl_FragColor = uColorMatrix * vec4(texelColor.rgb, 1);\n  }\n"]),this.buffers=X.qX(t,{aVertexPosition:[-1,-1,0,1,-1,0,1,1,0,-1,1,0],aTextureCoord:[0,1,1,1,1,0,0,0],indices:[0,1,2,0,2,3]})}var t,r;return t=e,r=[{key:"display",value:function(e,t,r,n,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=this.gl,l=u.canvas.getBoundingClientRect();i?(u.canvas.width=i.width,u.canvas.height=i.height):(u.canvas.width=l.width*window.devicePixelRatio,u.canvas.height=l.height*window.devicePixelRatio);var c=Math.max(r,n),s=r/c,f=n/c,p=a.Ue();p[0]=.5*s,p[5]=-.5*f;var h=Math.max(l.width,l.height),v=l.width/h,m=l.height/h,d=Math.max(u.canvas.width,u.canvas.height),y=u.canvas.width/d,g=u.canvas.height/d,b=Math.max(y/v,g/m),w=a.Ue();w[0]=2/y*b,w[5]=-2/g*b,o&&a.Jp(p,o,p),a.Jp(p,w,p),u.bindFramebuffer(u.FRAMEBUFFER,null),u.viewport(0,0,u.canvas.width,u.canvas.height),u.useProgram(this.program.program),u.clearColor(0,0,0,1),u.clear(u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT),u.enable(u.DEPTH_TEST),u.depthFunc(u.LEQUAL),X.o8(u,this.program,this.buffers),X.N9(this.program,{uPositionMatrix:p,uSampler:{texture:t},uColorMatrix:e}),u.drawElements(u.TRIANGLES,6,u.UNSIGNED_SHORT,0)}}],r&&he(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function me(e){var t=x(),r=(0,n.useRef)();r.current=e;var o=e.decor,i=e.post,u=e.projection,l=e.videoConstraints,c=(0,n.useRef)(),s=(0,n.useRef)(),f=(0,n.useRef)(),p=(0,n.useCallback)(t.wrap((function(e){c.current=e;var n=e.getContext("webgl2");if(!n)throw Error("Could not get webgl2 context");X.pV(n);var o=32;n.getExtension("EXT_color_buffer_float")||(n.getExtension("EXT_color_buffer_half_float")?o=16:t.onError(Error("Could not get WebGL extenstion EXT_color_buffer_float or EXT_color_buffer_half_float")));var i,u,l,p=X.cU(n,{mag:n.LINEAR,min:n.LINEAR,src:[0,0,255,255]}),h={width:1,height:1},v=!1,m=new pe(n,1e3,o),d=new ve(n),y=a.Ue();i=function(t){var o=r.current,i=o.decor,u=o.post,l=o.projection,c=o.captureSignal;f.current&&(n.bindTexture(n.TEXTURE_2D,p),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,f.current.camera),h=f.current.frame,v=!0,f.current=null);var s=a.Ue(),g=J.Ue(),b=h.width,w=h.height;if(l){var E=l(h.width/h.height);s=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return a.al(r,0,0,0,0,r*n,0,0,0,0,1,0,e,t,0,1)}(E.toScreen.x,E.toScreen.y,E.toScreen.scale);var x=E.screenBoundsInImage;J.Iu(g,g,W.al(.5+x.left/E.imageWidth,.5+x.top/E.imageHeight));var O=(x.right-x.left)/E.imageWidth,S=(x.bottom-x.top)/E.imageHeight;J.bA(g,g,W.al(O,S)),b=h.width*O,w=h.height*S}var C,T,j=a.Ue(),P=a.Ue();if(v){if(i){var A=m.sample(p,g),I=function(e,t){return A[4*e+t]};P=function(e,t,r){var n,o=null!==(n=r.corr)&&void 0!==n&&n,i=Q(e,Math.sqrt),u=Q(i,(function(e){return 1/e})),l=e;o&&(l=u.mmul(e).mmul(u));var c=new K.Z(l),s=Q(c.diagonalMatrix,(function(e){return 1/Math.sqrt(e)})),f=ee(r.sigma)(i).mmul(c.eigenvectorMatrix).mmul(s).mmul(c.eigenvectorMatrix.transpose());o&&(f=f.mmul(u));var p=function(e){return t=function(t,r){return t<e.rows&&r<e.columns?e.get(t,r):t==r?1:0},a.al(t(0,0),t(1,0),t(2,0),t(3,0),t(0,1),t(1,1),t(2,1),t(3,1),t(0,2),t(1,2),t(2,2),t(3,2),t(0,3),t(1,3),t(2,3),t(3,3));var t}(f),h=t.map((function(e){return-1*e})),v=ee(r.mean)(t),m=a.Ue();a.vc(m,h);var d=a.Ue();return a.vc(d,v),a.Jp(p,p,m),a.Jp(p,d,p),p}((T=(C=I)(3,3),Y(3,3,(function(e,t){return(C(e,t)-C(e,3)*C(3,t)/T)/(T-1)}))),$.al(I(0,3)/I(3,3),I(1,3)/I(3,3),I(2,3)/I(3,3)),i),P.some(isNaN)?P=y:y=P}u?a.Jp(j,u,P):j=P}var _,M=c();M&&(_={width:b,height:w}),d.display(j,p,h.width,h.height,s,_),M&&e.toBlob((function(e){(0,Z.saveAs)(e,M.fileName)}),M.type)},u=void 0,l=function(e){if(e!=u){u=e;for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return i.apply(void 0,[e].concat(r))}},s.current=l})),[]);function h(){s.current&&window.requestAnimationFrame(t.wrap(s.current))}return(0,q.F_)(h,[o,i,u]),n.createElement(n.Fragment,null,n.createElement("canvas",{ref:p,className:"maximal",style:{objectFit:"contain"}}),n.createElement(ne,{constraints:{audio:!1,video:l},onFrame:function(e,t,r){f.current={frame:t,camera:r},h()}}))}function de(e){var t=e.getBoundingClientRect(),r=document.body,n=document.documentElement,o=window.pageYOffset||n.scrollTop||r.scrollTop,a=window.pageXOffset||n.scrollLeft||r.scrollLeft,i=n.clientTop||r.clientTop||0,u=n.clientLeft||r.clientLeft||0,l=t.top+o-i,c=t.left+a-u;return{x:Math.round(c),y:Math.round(l),width:t.width,height:t.height}}function ye(e,t){var r=de(e),n=Math.max(r.height,r.width);return{x:(t.center.x-(r.x+r.width/2))/n,y:(t.center.y-(r.y+r.height/2))/n}}var ge=function(e){return e>1?{width:1,height:1/e}:{width:e,height:1}};function be(e,t,r){if(e>=t)return 0;var n,o,a,i=t/2-e/2;return n=-i,o=r,a=i,Math.max(n,Math.min(o,a))}function we(e,t){var r=t.x,n=t.y;return{x:r*e.scale+e.x,y:n*e.scale+e.y}}function Ee(e){var t=e.x,r=e.y,n=e.scale;return{x:-t/n,y:-r/n,scale:1/n}}function xe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a=[],i=!0,u=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){u=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(u)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Oe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Oe(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Se(e){if(e instanceof Function){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return e.apply(void 0,r)}return e}function Ce(e,t){var r=x(),o=(0,n.useState)((function(){return function(e,t,r){try{var n=window.localStorage.getItem(e);if(n)return JSON.parse(n)}catch(e){r.onError(e)}return Se(t)}(e,t,r)})),a=xe(o,2),i=a[0],u=a[1],l=(0,n.useCallback)((function(t){u((function(n){var o=Se(t,n);return function(e,t,r){try{var n=JSON.stringify(t);window.localStorage.setItem(e,n)}catch(e){r.onError(e)}}(e,o,r),o}))}),[r]);return[i,l]}var Te=r(157),je={value:"image/jpeg",label:"JPEG",extension:".jpg"},Pe={value:"image/png",label:"PNG",extension:".png"};function Ae(e){var t=e.value,r=e.onChange;return n.createElement(Te.ZP,{isSearchable:!1,value:t,options:[je,Pe],onChange:r})}function Ie(){return Ie=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ie.apply(this,arguments)}function _e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a=[],i=!0,u=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){u=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(u)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Me(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Me(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Me(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Re,ke=a.al(-1,0,0,0,0,-1,0,0,0,0,-1,0,1,1,1,1),Fe=[{decor:{}},{},{post:ke},{decor:{},post:ke}],Ne=function(e){return(e+1)%Fe.length},De=function(e){return(e+Fe.length-1)%Fe.length};function Be(e){var t=e.filePrefix,r=void 0===t?"Contrast Visor capture":t,o=x(),a=_e((0,n.useState)(!1),2),i=a[0],l=a[1],c=_e((0,n.useState)(0),2),s=c[0],f=c[1],p=_e((0,n.useState)(),2),h=p[0],v=p[1],m=_e(Ce("contrast-visor.settings.videoConstraints",H),2),d=m[0],y=m[1],g=_e(Ce("contrast-visor.settings.imageFormat",Pe),2),b=g[0],w=g[1],E=function(){var e=xe((0,n.useState)(),2),t=e[0],r=e[1],o=(0,n.useCallback)((function(e){r({set:!0,signal:e})}));return[(0,n.useCallback)((function(){if(null!=t&&t.set){t.set=!1;var e=t.signal;return t.signal=null,e}}),[t]),o]}(),C=_e(E,2),P=C[0],A=C[1],I="wrapper maximal "+(i?"settingsOpen":"settingsClosed"),_=Fe[s%Fe.length],M=_e((0,n.useState)({}),1)[0];M.tap=(0,n.useCallback)((function(){A({type:b.value,fileName:r+" "+(new Date).toJSON().replace("T"," ").replaceAll(":",".")+b.extension})}),[b,r]);var R=(0,n.useCallback)((function(e){var t,r=new(u().Manager)(e,{recognizers:[[u().Tap,{taps:2}],[u().Swipe],[u().Pinch]],touchAction:"none"});function n(){return window.getComputedStyle(e).getPropertyValue("--cv-horizontal-layout")}function o(e,t,o,a){r.on(e,(function(){return n()?o():a()})),r.on(t,(function(){return n()?a():o()}))}r.on("tap",(function(){return M.tap()})),o("swipeleft","swipedown",(function(){return l(!0)}),(function(){return f(Ne)})),o("swiperight","swipeup",(function(){return l(!1)}),(function(){return f(De)})),function(e,t,r){var n={x:0,y:0,scale:1},o=void 0,a=void 0;function i(t,r){var o,a,i=de(e),u=i.width/i.height,l=ge(u),c=l.width,s=l.height,f=ge(r),p=f.width,h=f.height,v=Math.min(c/p,s/h),m={x:0,y:0,scale:v},d=t.scale*v,y=be(c,p*d,t.x),g=be(s,h*d,t.y),b=(a=m,{x:(o=n={x:y,y:g,scale:t.scale}).scale*a.x+o.x,y:o.scale*a.y+o.y,scale:o.scale*a.scale}),w=Ee(b),E=we(w,{x:-c/2,y:-s/2}),x=we(w,{x:c/2,y:s/2});return{toScreen:b,screenBoundsInImage:{left:Math.max(-p/2,E.x),right:Math.min(p/2,x.x),top:Math.max(-h/2,E.y),bottom:Math.min(h/2,x.y)},imageWidth:p,imageHeight:h}}t.on("pinchstart",(function(t){var r=ye(e,t);a=we(Ee(n),r),o=n})),t.on("pinch",(function(t){var n=ye(e,t),u=Math.max(t.scale*o.scale,1),l={x:n.x-a.x*u,y:n.y-a.y*u,scale:u};r((function(e){return i(l,e)}))})),r((function(e){return i(n,e)}))}(e,r,(t=v,function(e){return t((function(){return e}))}))}),[]);return n.createElement("div",{className:I},n.createElement("div",{ref:R,className:"screen maximal",style:{position:"relative"}},n.createElement(T,{chainErrorHandler:o},n.createElement(S,null,n.createElement(me,Ie({videoConstraints:d,projection:h},_,{captureSignal:P}))))),n.createElement("div",{className:"settings"},n.createElement("h1",null,"Contrast Visor ",n.createElement("span",{className:"versionNumber"},"0.4.0")),n.createElement(G,{constraints:d,onChange:y}),n.createElement("label",null,"Image format:",n.createElement(Ae,{value:b,onChange:w})),n.createElement(O.Consumer,null,(function(e){return n.createElement(j,{errors:e})}))))}function Ue(e){var t=x();return n.createElement(S,null,n.createElement(C,{chainErrorHandler:t},n.createElement(Be,e)))}r(66),r(140),document.getElementById("errors"),document.getElementById("downloader"),o.render(n.createElement(Ue,null),document.getElementById("root")),"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("sw.js",{scope:"."}).then((function(e){console.log("SW registered: ",e)})).catch((function(e){console.log("SW registration failed: ",e)}))}));var Le=document.querySelector(".add-button");Le.style.display="none",window.addEventListener("beforeinstallprompt",(function(e){e.preventDefault(),Re=e,Le.style.display="block",Le.addEventListener("click",(function(){Le.style.display="none",Re.prompt(),Re.userChoice.then((function(e){"accepted"===e.outcome?console.log("User accepted the web prompt"):console.log("User dismissed the web prompt"),Re=null}))}))}))},66:(e,t,r)=>{e.exports=r.p+"imgs\\eye162.png"},140:(e,t,r)=>{e.exports=r.p+"manifest.webmanifest"}},r={};function n(e){var o=r[e];if(void 0!==o)return o.exports;var a=r[e]={exports:{}};return t[e].call(a.exports,a,a.exports,n),a.exports}n.m=t,e=[],n.O=(t,r,o,a)=>{if(!r){var i=1/0;for(s=0;s<e.length;s++){for(var[r,o,a]=e[s],u=!0,l=0;l<r.length;l++)(!1&a||i>=a)&&Object.keys(n.O).every((e=>n.O[e](r[l])))?r.splice(l--,1):(u=!1,a<i&&(i=a));if(u){e.splice(s--,1);var c=o();void 0!==c&&(t=c)}}return t}a=a||0;for(var s=e.length;s>0&&e[s-1][2]>a;s--)e[s]=e[s-1];e[s]=[r,o,a]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),(()=>{var e={179:0};n.O.j=t=>0===e[t];var t=(t,r)=>{var o,a,[i,u,l]=r,c=0;if(i.some((t=>0!==e[t]))){for(o in u)n.o(u,o)&&(n.m[o]=u[o]);if(l)var s=l(n)}for(t&&t(r);c<i.length;c++)a=i[c],n.o(e,a)&&e[a]&&e[a][0](),e[i[c]]=0;return n.O(s)},r=self.webpackChunkcontrastvisor=self.webpackChunkcontrastvisor||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var o=n.O(void 0,[216],(()=>n(262)));o=n.O(o)})();